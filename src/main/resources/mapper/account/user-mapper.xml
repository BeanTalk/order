<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 用户数据访问映射 -->
<mapper namespace="com.saituo.order.dao.account.UserDao" >

    <select id="get" resultType="hashmap">
          SELECT
            id AS "id",
            email AS "email",
            nickname AS "nickname",
            password AS "password",
            state AS "state",
            username AS "username"
          FROM
            tb_user
          WHERE
              id = #{id}
    </select>

    <select id="getByUsernameOrEmail" resultType="hashmap">
          SELECT
            id AS "id",
            email AS "email",
            name AS "name",
            password AS "password",
            login_name AS "login_name"
          FROM
            sys_user
          WHERE
            login_name = #{usernameOrEmail} OR email = #{usernameOrEmail}
    </select>

    <select id="find" resultType="hashmap">
        SELECT
          id AS "id",
          email AS "email",
          name AS "name",
          password AS "password",
          login_name AS "login_name"
        FROM
          sys_user
        WHERE
          del_flag = 0 
        <if test="filter.username != null and filter.username != ''">
            <bind name="filter.username" value=" '%' + filter.username + '%' " />
            AND login_name LIKE #{filter.login_name}
        </if>

        <if test="filter.name != null and filter.name != ''">
            <bind name="filter.name" value=" '%' + filter.name + '%' " />
            AND nickname LIKE #{filter.name}
        </if>

        <if test="filter.email != null and filter.email != ''">
            <bind name="filter.email" value=" '%' + filter.email + '%' " />
            AND email LIKE #{filter.email}
        </if>
        ORDER BY id DESC
        <if test="filter.first != null and filter.last != null">
            LIMIT #{filter.first},#{filter.last}
        </if>
    </select>

    <select id="count" resultType="long">
        SELECT
          COUNT(id)
        FROM
          sys_user
        WHERE
          del_flag = 0
        <if test="filter.login_name != null and filter.login_name != ''">
          <bind name="filter.login_name" value=" '%' + filter.login_name + '%' " />
          AND login_name LIKE #{filter.username}
        </if>

        <if test="filter.email != null and filter.email != ''">
          <bind name="filter.email" value=" '%' + filter.email + '%' " />
          AND email LIKE #{filter.email}
        </if>
    </select>

    <update id="update">
        <trim prefix="SET" suffixOverrides="," />
        UPDATE
          tb_user
        SET
          email=#{entity.email},
          nickname=#{entity.nickname},
          state=#{entity.state}
        WHERE
          id = #{entity.id}
    </update>

    <update id="updatePassword">
        UPDATE
          tb_user
        SET
          password = #{password}
        WHERE
          id = #{id}
    </update>

</mapper>