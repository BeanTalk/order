<#assign shiro=JspTaglibs["/WEB-INF/taglib/shiro.tld"] />
<#assign form=JspTaglibs["/WEB-INF/taglib/spring-form.tld"] />
<#assign spring=JspTaglibs["/WEB-INF/taglib/spring.tld"] />
<#assign base="${request.contextPath}" />

<!DOCTYPE html>
<html>
<head>
    <title>纳川创奇</title>
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-store">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" type="text/css" href="${base}/resource/css/select.css">
    <link rel="stylesheet" type="text/css" href="${base}/resource/css/style.css">
    <link rel="stylesheet" type="text/css" href="${base}/resource/css/reset.css">
	
	<script src="${base}/resource/script/jquery-1.8.2.js" type="text/javascript"></script>
    <script src="${base}/resource/script/jquery.confirm.min.js" type="text/javascript"></script>
    <script src="${base}/resource/script/jquery.validate.min.js" type="text/javascript"></script>
	<script src="${base}/resource/script/init.js" type="text/javascript"></script>
	<script src="${base}/resource/script/jquery-shopping.js" type="text/javascript"></script>
	<script src="${base}/resource/script/default.config.js" type="text/javascript"></script>
	
</head>
<body>
	<#--未登录显示信息与登录后显示的样式不同-->
	<#-- 未登录显示 -->
    <@shiro.notAuthenticated>
    	<#include "./header.html" />
		<@body/>
	</@shiro.notAuthenticated>
	
	<#-- 已登录显示 -->
    <@shiro.user>
		<@shiro.hasPermission name ="authc">
    	<#include "./header.html" />
    	<div class="containerPx clearfix">
			<#include "./navbar.html" />
			<@body/>
		</div>
		</@shiro.hasPermission>
	</@shiro.user>
	<#--每个页面对应的js或特殊处理-->
    <#if head?exists>
        <@head/>
    </#if>
    
    <script src="${base}/resource/script/maked.js" type="text/javascript"></script>
</body>
</html>

<#-- 菜单显示的宏方法,在navbar中进行调用,每个用户所看到的不同菜单-->
<#macro recursionMenu menu id=false>
    <#if menu.children?size gt 0>
    <ul class="subnav-body">
        <#list menu.children as c>
            <li <#if c.children?size gt 0>class="subnav-title"</#if>>
                <a <#if id>id="${c.id}"</#if> href="<#if c.value?has_content>${base}/${c.value?substring(1,c.value?length - 3)}<#else>javascript:;</#if>">
                    <span class="${c.icon!'glyphicon glyphicon-file'}"> </span> ${c.name}
                </a>
                <@recursionMenu c />
            </li>
        </#list>
    </ul>
    </#if>
</#macro>

<#-- 分页宏pagination 将formId和page传入后自动生成分页条 -->
<#macro pagination formId page>
<div class="paging-bar">
    <script type="text/javascript">
        //跳转到指定的页面
        function jumpToSpecificPage(pageNumber,form) {
            $("#pageNumber").val(pageNumber);
            $("#" + form).submit();
        }
    </script>
    <ul class="pagination pull-right">
        <li>
        <span>
            共 ${page.totalElements} 条 ${page.number + 1} / ${page.totalPages} 页
        </span>
        </li>
        <#if page.hasPrevious()>
            <li>
                <a href="javascript:;" onclick="jumpToSpecificPage(${page.number - 1},'${formId!''}');">&laquo;</a>
            </li>
        </#if>
        <#if page.hasNext()>
            <li>
                <a href="javascript:;" onclick="jumpToSpecificPage(${page.number + 1},'${formId!''}');">&raquo;</a>
            </li>
        </#if>
    </ul>
</div>
</#macro>

<#macro formErrors>
    <#assign formErrors><@form.errors path="*" /></#assign>
    <#if formErrors?has_content>
        <div id="errors">
            <@spring.message "admin.error.globalMessage" />
        </div>
    </#if>
</#macro>

<#macro pager pager baseUrl parameterMap = {} maxShowPageCount = 4>

	<#local pageNumber = pager.pageNumber />
	<#local pageSize = pager.pageSize />
	<#local pageCount = pager.totalPages />
	<#local parameter = "" />

	<#local parameter = parameter + "&pageSize=" + pageSize />
	<#list parameterMap?keys as key>
		<#if parameterMap[key]??>
			<#local parameter = parameter + "&" + key + "=" + parameterMap[key] />
		</#if>
	</#list>
	
	<#if baseUrl?contains("?")>
		<#local baseUrl = baseUrl + "&" />
	<#else>
		<#local baseUrl = baseUrl + "?" />
	</#if>
	
	<#local firstPageUrl = baseUrl + "pageNumber=1" + parameter />
	<#local lastPageUrl = baseUrl + "pageNumber=" + pageCount + parameter />
	<#local prePageUrl = baseUrl + "pageNumber=" + (pageNumber - 1) + parameter />
	<#local nextPageUrl = baseUrl + "pageNumber=" + (pageNumber + 1) + parameter />

	<#if maxShowPageCount <= 0>
		<#local maxShowPageCount = 4>
	</#if>
	
	<#local segment = ((pageNumber - 1) / maxShowPageCount)?int + 1 />
	<#local startPageNumber = (segment - 1) * maxShowPageCount + 1 />
	<#local endPageNumber = segment * maxShowPageCount />
	
	<#if (startPageNumber < 1)>
		<#local startPageNumber = 1 />
	</#if>
	
	<#if (endPageNumber > pageCount)>
		<#local endPageNumber = pageCount />
	</#if>

	<#if (pageCount > 1)>
	<div class="page">
			<#-- 首页 -->
			<#if (pageNumber > 1)>
				<a href="${firstPageUrl}">首页</a>
			<#else>
				<span>首页</span>
			</#if>
			
			<#-- 上一页 -->
			<#if (pageNumber > 1)>
				<a href="${prePageUrl}">上一页</a>
			<#else>
				<span>上一页</span>
			</#if>
			
			<#if (startPageNumber > 1)>
				<a href="${baseUrl + "pageNumber=" + (pageNumber - 2) + parameter}">...</a>
			</#if>
			
			<#list startPageNumber .. endPageNumber as index>
				<#if pageNumber != index>
					<a href="${baseUrl + "pageNumber=" + index + parameter}">${index}</a>
				<#else>
					<span>${index}</span>
				</#if>
			</#list>
			
			<#if (endPageNumber < pageCount)>
				<a href="${baseUrl + "pageNumber=" + (pageNumber + 2) + parameter}">...</a>
			</#if>
		    
			<#-- 下一页 -->
			<#if (pageNumber < pageCount)>
				<a href="${nextPageUrl}">下一页</a>
			<#else>
				<span>下一页</span>
			</#if>
			
			<#-- 末页 -->
			<#if (pageNumber < pageCount)>
				<a href="${lastPageUrl}">末页</a>
			<#else>
				<span>末页</span>
			</#if>
			共 ${pageCount} 页
		</div>
	</#if>

</#macro>