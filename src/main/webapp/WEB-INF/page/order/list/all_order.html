<#include "*/basic/default.html"/>

<#macro head>
<script type="text/javascript">
	$("#query_btn").click(function(event){
		$("#head_query_form").attr("action", "${viewURL}");
		$("#head_query_form").submit();
	});
</script>
</#macro>

<#macro body>

<#assign viewURL = "${base}/order/list/all_order">
<div class="grid2 m_t">
<div class="panel">
	<div class="panel_header">
		<h3>所有订单</h3>
	</div>
	<div class="panel_body clearfix">
		<form id="head_query_form">
			<table width="100%">
				<tbody>
					<tr>
						<td width="60" nowrap="nowrap">开始时间</td>
			            <td width="70" nowrap="nowrap"><input name="startDate" type="text" class="datepicker" size="12" value="${startDate!""}"></td>
			            <td width="60" nowrap="nowrap">结束时间</td>
			            <td width="70" nowrap="nowrap"><input name="endDate" type="text" class="datepicker" size="12" value="${endDate!""}"></td>
			            <td width="60" nowrap="nowrap">订单号:
			            	<input type="text" id="userOrderId" name="userOrderId" value="${userOrderId!""}">
			            </td>
			        </tr>
			        <tr>
				        <td width="60" nowrap="nowrap">订单状态:
			            	<select name="statusCd" id="statusCd">
		                        <option value="">请选择...</option>
		                        <#list states?keys as key>  
					            	<option value="${key}" <#if key == statusCd!"">selected</#if>>${states[key]!""}</option>
								</#list> 
		                    </select>
			            </td>
			            <#if role=="teacher">
				            <td width="60" nowrap="nowrap">订购人:
				            	<select name="userId" id="userId">
				            		<#if userInfoMap?size == 0>
			                        	<option value="">请选择...</option>
			                        <#else>
			                        	<#list userInfoMap?keys as key>  
			                        		<option value="${key}" <#if key == userId!"">selected</#if>> ${userInfoMap[key]!""}</option>
			                        	</#list>
			                        </#if>
			                    </select>
				            </td>
				        </#if>
			            <#if role=="internal">
				            <td width="60" nowrap="nowrap">课题组:
				            	<select name="groupId" id="groupId">
			                        <option value="">请选择...</option>
			                        <#list offices?keys as key>  
						            	<option value="${key}" <#if key == groupId!"">selected</#if>>${offices[key]!""}</option>
									</#list> 
			                    </select>
				            </td>
				            <td width="60" nowrap="nowrap">订购人:
				            	<select name="userId" id="userId">
				            		<option value="">请选择...</option>
			                    </select>
				            </td>
				        </#if>
				   </tr>
				   <tr>
			            <td width="58" nowrap="nowrap">
			            	<div id="query_btn" class="button white medium">检索</div>
			            </td>
					</tr>
				</tbody>
			</table>
		</form>
		<br>
		<form id="list-form" action="" method="post">
	        <table width="100%" class="table_pro_header">
				<tbody>
					<tr>
			            <th width="238" align="left">产品</th>
			            <th width="80" align="left">规格</th>
			            <th width="60" align="left">单位</th>
			            <th width="100" align="left">目录价</th>
			            <th width="100" align="left">订购价</th>
			            <th width="80" align="left">数量</th>
			            <th width="80" align="left">订单状态</th>
					</tr>
				</tbody>
			</table>
	        <table width="100%" class="table_pro_body_t">
				<tbody>
					<#if page.content?size == 0>
	                    <tr>
	                        <td colspan="6">没有记录</td>
	                    </tr>
	                <#else>
	                    <#list page.content as r>
		                    <tr class="user_order_toggle_tr" id="${r.userOrderReturn.userOrderId!""}">
		                    	<th width="30"></th>
					            <th align="left" colspan="1">订单号:${r.userOrderReturn.userOrderId!""}</th>
					            <th align="left" colspan="2">订货人:${r.userOrderReturn.userName!""}</th>
					            <th align="left" colspan="2">下单时间:${r.userOrderReturn.acceptDate!""}</th>
					            <th align="left" colspan="2">当前状态:${states[r.userOrderReturn.statusCd]!""}</th>
							</tr>
							<#list r.productOrderReturn as productOrderInfo>
			                    <tr class="tr_${r.userOrderReturn.userOrderId!""}">
									<td width="30">
									</td>
			                        <td width="248" align="left">
										<p><span class="pro_name">${productOrderInfo.product.productName!""}</span></p>
										<p><b>货号：</b>${productOrderInfo.product.productNum!""}</p>
										<p><b>品牌：</b>${productOrderInfo.product.brandId!""}</p>
									</td>
			                        <td width="80" align="center">${productOrderInfo.product.specValue!""}</td>
			                        <td width="60" align="center">${productOrderInfo.product.unitValue!""}</td>
			                        <td width="100" align="center">${productOrderInfo.product.catalogFee!""}</td>
						            <td width="100" align="center">${productOrderInfo.orderFee!""}</td>
									<td width="80" align="center">${productOrderInfo.orderNum!1}</td>
									<td width="80" align="center">${productStates[productOrderInfo.statusCd]!""}</td>
			                    </tr>
		                    </#list>
		                    <#if r.addressReturn??>
		                    	<@address_plugin r.addressReturn />
		                    <#else>
		                    	<@address_undefine />
		                    </#if>
	                    </#list>
	                </#if>
				</tbody>
			</table>
			<p class="pageBar"></p>
	    	<#assign parameterMap = { "startDate": "${startDate!}", "endDate": "${endDate!}", "userOrderId" : "${userOrderId!}", "statusCd" :"${statusCd!}", "userId": "${userId!}", "groupId" : "${groupId!}"}>
			<@pager page "${viewURL}" parameterMap />
		</form>
 	</div>
</div>
</div>
</#macro>